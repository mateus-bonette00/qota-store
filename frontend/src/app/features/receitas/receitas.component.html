<div class="receitas-page">
  <!-- Aba de Receitas (FBA) -->
  <div *ngIf="activeTab === 'receitas'">
    <h2 class="section-title">Produtos Vendidos (Receitas)</h2>

    <!-- Formulário de Cadastro -->
    <div class="form-card">
      <div class="form-row">
        <div class="form-group">
          <label>Data do crédito</label>
          <input type="date" [(ngModel)]="novaReceita.data" class="form-input" />
        </div>

        <div class="form-group">
          <label>Produto vendido (SKU | UPC | Nome)</label>
          <select (change)="onProdutoSelect($event)" class="form-input">
            <option value="">Selecione um produto</option>
            <option *ngFor="let produto of produtos" [value]="produto.id">
              {{ produto.sku || '' }} | {{ produto.upc || '' }} | {{ produto.nome }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Quantidade vendida</label>
          <input type="number" [(ngModel)]="novaReceita.quantidade" class="form-input" min="1" />
        </div>

        <div class="form-group">
          <label>Valor recebido (USD) por unidade</label>
          <input type="number" [(ngModel)]="novaReceita.valor" class="form-input" step="0.01" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Quem lançou</label>
          <input type="text" [(ngModel)]="novaReceita.quem" class="form-input" placeholder="Nome" />
        </div>

        <div class="form-group">
          <label>Observação</label>
          <input type="text" [(ngModel)]="novaReceita.descricao" class="form-input" placeholder="Observação" />
        </div>
      </div>

      <button class="btn-submit" (click)="adicionarRecebimento()">
        Adicionar recebimento (Amazon)
      </button>
    </div>

    <!-- Resumos -->
    <div class="summary-grid" *ngIf="summary">
      <div class="summary-card">
        <h3>VENDIDO NO PERÍODO — {{ selectedMonth }}/{{ selectedYear }}</h3>
        <div class="summary-item">
          <span>Quantidade:</span>
          <span class="value-green">{{ summary.quantidade_vendas }}</span>
        </div>
        <div class="summary-item">
          <span>Valor:</span>
          <span class="value-green">${{ summary.total_bruto_usd.toFixed(2) }}</span>
        </div>
      </div>

      <div class="summary-card">
        <h3>VENDIDO (TOTAL — TODOS OS MESES)</h3>
        <div class="summary-item">
          <span>Quantidade:</span>
          <span class="value-green">{{ summary.quantidade_vendas }}</span>
        </div>
        <div class="summary-item">
          <span>Valor:</span>
          <span class="value-green">${{ summary.total_bruto_usd.toFixed(2) }}</span>
        </div>
      </div>
    </div>

    <!-- Tabela de Receitas -->
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>DATA</th>
            <th>PRODUTO</th>
            <th>SKU</th>
            <th>QTD</th>
            <th>VALOR (USD)</th>
            <th>QUEM</th>
            <th>AÇÕES</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="loading">
            <td colspan="8" class="text-center">Carregando...</td>
          </tr>
          <tr *ngIf="!loading && receitas.length === 0">
            <td colspan="8" class="text-center">Nenhuma receita encontrada</td>
          </tr>
          <tr *ngFor="let receita of receitas">
            <td>{{ receita.id }}</td>
            <td>{{ receita.data }}</td>
            <td>{{ receita.descricao || '-' }}</td>
            <td>{{ receita.sku || '-' }}</td>
            <td>{{ receita.quantidade }}</td>
            <td>${{ receita.valor_usd?.toFixed(2) || '0.00' }}</td>
            <td>{{ receita.quem || '-' }}</td>
            <td>
              <button class="btn-delete" (click)="excluirReceita(receita.id!)">Excluir</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Aba de Gráficos -->
  <div *ngIf="activeTab === 'graficos'">
    <h2 class="section-title">Gráficos</h2>

    <div class="chart-wrapper">
      <canvas baseChart
        [data]="receitasDespesasChartData"
        [options]="receitasDespesasChartOptions"
        type="line">
      </canvas>
    </div>

    <div class="chart-wrapper">
      <canvas baseChart
        [data]="resultadoMesChartData"
        [options]="resultadoMesChartOptions"
        type="bar">
      </canvas>
    </div>

    <div class="charts-grid">
      <div class="chart-box">
        <canvas baseChart
          [data]="topProdutosMesChartData"
          [options]="topProdutosMesChartOptions"
          type="bar">
        </canvas>
      </div>

      <div class="chart-box">
        <canvas baseChart
          [data]="topProdutosAnoChartData"
          [options]="topProdutosAnoChartOptions"
          type="bar">
        </canvas>
      </div>

      <div class="chart-box">
        <canvas baseChart
          [data]="bottomProdutosMesChartData"
          [options]="bottomProdutosMesChartOptions"
          type="bar">
        </canvas>
      </div>

      <div class="chart-box">
        <canvas baseChart
          [data]="bottomProdutosAnoChartData"
          [options]="bottomProdutosAnoChartOptions"
          type="bar">
        </canvas>
      </div>
    </div>
  </div>

  <!-- Aba de Despesas -->
  <div *ngIf="activeTab === 'despesas'">
    <h2 class="section-title">Despesas</h2>
    <p class="text-center">Funcionalidade já disponível em /despesas</p>
  </div>

  <!-- Aba de Produtos Comprados -->
  <div *ngIf="activeTab === 'produtos-comprados'">
    <h2 class="section-title">Produtos Comprados</h2>
    <p class="text-center">Em desenvolvimento...</p>
  </div>
</div>
